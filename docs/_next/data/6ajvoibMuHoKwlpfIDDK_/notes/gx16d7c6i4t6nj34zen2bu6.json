{"pageProps":{"note":{"id":"gx16d7c6i4t6nj34zen2bu6","title":"0202 [Javascript] CSV 檔數字千分位、字串都是數字","desc":"","updated":1679456054808,"created":1675303666200,"custom":{},"fname":"drops.2023.0202-[Javascript] CSV 檔數字千分位、字串都是數字","type":"note","vault":{"fsPath":"vault"},"contentHash":"45e06d8a14172d9134c3e8f8fde2645d","links":[],"anchors":{"csv-檔數字千分位字串都是數字":{"type":"header","text":"CSV 檔數字千分位、字串都是數字","value":"csv-檔數字千分位字串都是數字","line":8,"column":0,"depth":2},"demo":{"type":"header","text":"Demo","value":"demo","line":10,"column":0,"depth":3},"csv":{"type":"header","text":"csv","value":"csv","line":16,"column":0,"depth":3},"下載-csv":{"type":"header","text":"下載 csv","value":"下載-csv","line":43,"column":0,"depth":3},"千分位加逗號":{"type":"header","text":"千分位加逗號","value":"千分位加逗號","line":154,"column":0,"depth":3},"小結":{"type":"header","text":"小結","value":"小結","line":203,"column":0,"depth":2}},"children":[],"parent":"unroh28we8qrl7g9sfhmx0v","data":{}},"body":"<h1 id=\"0202-javascript-csv-檔數字千分位字串都是數字\">0202 [Javascript] CSV 檔數字千分位、字串都是數字<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#0202-javascript-csv-檔數字千分位字串都是數字\"></a></h1>\n<h2 id=\"csv-檔數字千分位字串都是數字\">CSV 檔數字千分位、字串都是數字<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#csv-檔數字千分位字串都是數字\"></a></h2>\n<h3 id=\"demo\">Demo<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#demo\"></a></h3>\n<p><a href=\"https://kiwijang.github.io/csvDemo/\">Demo</a></p>\n<p><img src=\"/assets/images/2023-02-02-16-25-57.png\"></p>\n<h3 id=\"csv\">csv<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#csv\"></a></h3>\n<p><a href=\"https://zh.wikipedia.org/zh-tw/%E9%80%97%E5%8F%B7%E5%88%86%E9%9A%94%E5%80%BC\">CSV - wiki</a></p>\n<p>逗號分隔值（Comma-Separated Values，CSV，有時也稱為字元分隔值，因為分隔字元也可以不是逗號），其檔案以純文字形式儲存表格資料（數字和文字）。純文字意味著該檔案是一個字元序列，不含必須像二進位數字那樣被解讀的資料。</p>\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types\">MIME text - MDN</a></p>\n<blockquote>\n<p>Text-only data including any human-readable content, source code, or textual data such as comma-separated value (CSV) formatted data. Examples include: text/plain, text/csv, and text/html. (Registration at IANA)</p>\n</blockquote>\n<p>所以 csv 是人類可讀的純文字。</p>\n<p>以 Demo 的內容為例，用逗號 <code>,</code> 分隔，可以看出這是一個表格:</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript\">代號<span class=\"token punctuation\">,</span>時間<span class=\"token punctuation\">,</span>貨幣 <span class=\"token comment\">// 表頭</span>\n<span class=\"token operator\">=</span><span class=\"token string\">\"123\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">02</span><span class=\"token operator\">-</span><span class=\"token number\">02</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"TWD 19,832,391,293\"</span> <span class=\"token comment\">// 第1行</span>\n<span class=\"token operator\">=</span><span class=\"token string\">\"000004324\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">03</span><span class=\"token operator\">-</span><span class=\"token number\">01</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"TWD 0.231123\"</span>  <span class=\"token comment\">// 第2行</span>\n<span class=\"token maybe-class-name\">Bfwer123213f</span><span class=\"token punctuation\">,</span><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">05</span><span class=\"token operator\">-</span><span class=\"token number\">09</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"TWD -291,032,903.12312\"</span> <span class=\"token comment\">// 第3行</span>\n</code></pre>\n<p>備註:</p>\n<ul>\n<li>\n<p><code>=\"000004324\"</code> 代號用 excel SUM 公式去寫是因為用 excel 打開有可能會變成數字，造成 0 消失...</p>\n</li>\n<li>\n<p><code>\"TWD 19,832,391,293\"</code> 貨幣有千分號所以要多加 <code>\"</code> 去做區隔，不然會被 csv 誤解。</p>\n</li>\n</ul>\n<h3 id=\"下載-csv\">下載 csv<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#下載-csv\"></a></h3>\n<pre class=\"language-typescript\"><code class=\"language-typescript\">\n<span class=\"token comment\">// 我自訂的表格資料格式，要將這些資料轉換成上方用逗號個開的格式</span>\ndemoData <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n<span class=\"token punctuation\">{</span>\n    demoSeq<span class=\"token operator\">:</span> <span class=\"token string\">'123'</span><span class=\"token punctuation\">,</span>\n    demoDate<span class=\"token operator\">:</span> <span class=\"token string\">'2023-02-02T00:00:00'</span><span class=\"token punctuation\">,</span>\n    demoCurrency<span class=\"token operator\">:</span> <span class=\"token string\">'TWD'</span><span class=\"token punctuation\">,</span>\n    demoTotal<span class=\"token operator\">:</span> <span class=\"token number\">19832391293</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">{</span>\n    demoSeq<span class=\"token operator\">:</span> <span class=\"token string\">'000004324'</span><span class=\"token punctuation\">,</span>\n    demoDate<span class=\"token operator\">:</span> <span class=\"token string\">'2023-03-01T19:00:00'</span><span class=\"token punctuation\">,</span>\n    demoCurrency<span class=\"token operator\">:</span> <span class=\"token string\">'TWD'</span><span class=\"token punctuation\">,</span>\n    demoTotal<span class=\"token operator\">:</span> <span class=\"token number\">0.231123</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">{</span>\n    demoSeq<span class=\"token operator\">:</span> <span class=\"token string\">'Bfwer123213f'</span><span class=\"token punctuation\">,</span>\n    demoDate<span class=\"token operator\">:</span> <span class=\"token string\">'2023-05-09T00:00:00'</span><span class=\"token punctuation\">,</span>\n    demoCurrency<span class=\"token operator\">:</span> <span class=\"token string\">'TWD'</span><span class=\"token punctuation\">,</span>\n    demoTotal<span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">291032903.12312</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 下載 csv</span>\n<span class=\"token function\">downloadCSV2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> headerKey <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'demoSeq'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'demoDate'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'demoTotal'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> headerName <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'代號'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'時間'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'貨幣'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 轉換為我自訂的 tbody 資料格式:</span>\n    <span class=\"token comment\">// [[代號,時間,貨幣], [代號,時間,貨幣], [代號,時間,貨幣]]</span>\n    <span class=\"token keyword\">const</span> csvFileData <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">demoData</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> arr<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        headerKey<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'demoTotal'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            arr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">'\"'</span> <span class=\"token operator\">+</span>\n                x<span class=\"token punctuation\">.</span><span class=\"token property-access\">demoCurrency</span> <span class=\"token operator\">+</span>\n                <span class=\"token string\">' '</span> <span class=\"token operator\">+</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">_formateThousand</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x <span class=\"token keyword module\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n                <span class=\"token string\">'\"'</span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'demoDate'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            arr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x <span class=\"token keyword module\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'T'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n            arr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x <span class=\"token keyword module\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword control-flow\">return</span> arr<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// csv 表頭格式</span>\n    <span class=\"token keyword\">let</span> csv <span class=\"token operator\">=</span> headerName<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'\\n'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 將自訂的 tbody 格式轉換為 csv 格式</span>\n    csvFileData<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        row <span class=\"token operator\">=</span> row<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 空值要轉 --</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>r <span class=\"token operator\">===</span> <span class=\"token keyword null nil\">null</span> <span class=\"token operator\">||</span> r <span class=\"token operator\">===</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword control-flow\">return</span> <span class=\"token string\">'--'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// idx !== 0 是指不是 [代號] 欄位才要加千分位，</span>\n        <span class=\"token comment\">// 其餘欄位若是數字就加千分位</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>idx <span class=\"token operator\">!==</span> <span class=\"token number\">0</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> r <span class=\"token operator\">===</span> <span class=\"token string\">'number'</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span><span class=\"token function\">isNaN</span><span class=\"token punctuation\">(</span><span class=\"token operator\">+</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// 加千分位</span>\n            result <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">_formateThousand</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token string\">'\"'</span> <span class=\"token operator\">+</span> <span class=\"token known-class-name class-name\">String</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'\"'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// [代號] 有可能都是數字 要顯示成字串</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isNaN</span><span class=\"token punctuation\">(</span><span class=\"token operator\">+</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token string\">'=\"'</span> <span class=\"token operator\">+</span> <span class=\"token known-class-name class-name\">String</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'\"'</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token known-class-name class-name\">String</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        csv <span class=\"token operator\">+=</span> row<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        csv <span class=\"token operator\">+=</span> <span class=\"token string\">'\\n'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">downloadRef2</span><span class=\"token operator\">?.</span>nativeElement<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 設定 html &#x3C;a> 屬性讓他可下載 csv</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">downloadRef2</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">nativeElement</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'href'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'data:text/csv;charset=utf-8,\\ufeff'</span> <span class=\"token operator\">+</span> <span class=\"token function\">encodeURI</span><span class=\"token punctuation\">(</span>csv<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">downloadRef2</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">nativeElement</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'download'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">匯出報表_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">formatDate</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">Date</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'yyyyMMdd'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">localeId</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.csv</span><span class=\"token template-punctuation string\">`</span></span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>備註:</p>\n<ul>\n<li>\n<p><code>data:text/csv;charset=utf-8,\\ufeff</code> 是 data URIs，代表 <code>text/csv</code> MIME 類型、以 <code>utf-8</code> 編碼、<code>\\ufeff</code> 避免亂碼。更多詳情請參閱 <a href=\"https://developer.mozilla.org/zh-TW/docs/Web/HTTP/Basics_of_HTTP/Data_URLs\">data URIs - MDN</a>。</p>\n<blockquote>\n<p>data URIs, 由 RFC 2397 文件定義, 允許作者在文件中嵌入檔案.</p>\n</blockquote>\n</li>\n<li>\n<p>要加 <code>\\ufeff</code> 是為了避免 excel 開啟為亂碼，參考自 <a href=\"https://bonze.tw/javascript-client-generate-csv/\">JavaScript 瀏覽器端產生 csv 檔案 by jimmy8646</a>。</p>\n</li>\n<li>\n<p><a href=\"https://zh.wikipedia.org/zh-hant/%E4%BD%8D%E5%85%83%E7%B5%84%E9%A0%86%E5%BA%8F%E8%A8%98%E8%99%9F\">位元組順序記號</a></p>\n<blockquote>\n<p>位元組順序記號（英語：byte-order mark，BOM）是位於碼點 U+FEFF 的統一碼字符的名稱。當以 UTF-16 或 UTF-32 來將 UCS/統一碼字符所組成的字串編碼時，這個字符被用來標示其位元組序。它常被用來當做標示文件是以 UTF-8、UTF-16 或 UTF-32 編碼的記號。</p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"千分位加逗號\">千分位加逗號<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#千分位加逗號\"></a></h3>\n<pre class=\"language-typescript\"><code class=\"language-typescript\">  <span class=\"token doc-comment comment\">/**\n   * 千分位加逗號\n   * <span class=\"token keyword\">@param</span> <span class=\"token parameter\">numberStr</span> string | number\n   * <span class=\"token keyword\">@returns</span> string\n   */</span>\n  <span class=\"token keyword\">private</span> <span class=\"token function\">_formateThousand</span><span class=\"token punctuation\">(</span>numberStr<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> numStr <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">String</span><span class=\"token punctuation\">(</span>numberStr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> isMinus <span class=\"token operator\">=</span> numStr<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">'-'</span> <span class=\"token operator\">?</span> <span class=\"token boolean\">true</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>isMinus<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> numStrArr <span class=\"token operator\">=</span> numStr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      numStrArr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      numStr <span class=\"token operator\">=</span> numStrArr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> arr <span class=\"token operator\">=</span> numStr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 整數位</span>\n    <span class=\"token keyword\">const</span> int <span class=\"token operator\">=</span> arr<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> intArr <span class=\"token operator\">=</span> int<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> len <span class=\"token operator\">=</span> intArr<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 總共會有幾個千分位逗號</span>\n    <span class=\"token keyword\">let</span> commasCount <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">floor</span><span class=\"token punctuation\">(</span>len <span class=\"token operator\">/</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 被整除的話要減一(第一位不用千分逗號)</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>len <span class=\"token operator\">%</span> <span class=\"token number\">3</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      commasCount <span class=\"token operator\">=</span> commasCount <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// 千分位加逗號</span>\n    <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&#x3C;=</span> commasCount<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      intArr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">splice</span><span class=\"token punctuation\">(</span>len <span class=\"token operator\">-</span> <span class=\"token number\">3</span> <span class=\"token operator\">*</span> i<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">&#x3C;=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 沒有小數點以下</span>\n      result <span class=\"token operator\">=</span> intArr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> point <span class=\"token operator\">=</span> arr<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// 小數點以下加回</span>\n      result <span class=\"token operator\">=</span> intArr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'.'</span> <span class=\"token operator\">+</span> point<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 負數要把-加回</span>\n    <span class=\"token keyword control-flow\">return</span> isMinus <span class=\"token operator\">?</span> <span class=\"token string\">'-'</span> <span class=\"token operator\">+</span> result <span class=\"token operator\">:</span> result<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n</code></pre>\n<h2 id=\"小結\">小結<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#小結\"></a></h2>\n<ul>\n<li>\n<p>設定格式的 Data URIs <code>data:text/csv;charset=utf-8,\\ufeff</code> 包含 MIME 類型、編碼、<code>utf-8</code> 的十六進位用 <code>\\ufeff</code> 表示。</p>\n</li>\n<li>\n<p>Math.floor() 無條件捨去，正負都會往右移(變小)。</p>\n</li>\n</ul>\n<pre class=\"language-javascript\"><code class=\"language-javascript\">\n <span class=\"token comment\">// 正→負排列圖:</span>\n → <span class=\"token punctuation\">[</span><span class=\"token number\">1.4</span><span class=\"token punctuation\">]</span> →  → → <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> → <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1.4</span><span class=\"token punctuation\">]</span> →\n\n <span class=\"token comment\">// 無條件捨去</span>\n              ↓                      ↓\n → <span class=\"token punctuation\">[</span><span class=\"token number\">1.4</span><span class=\"token punctuation\">]</span> → <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> → <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> → <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1.4</span><span class=\"token punctuation\">]</span> → <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> →\n</code></pre>","noteIndex":{"id":"root","title":"( Φ w Φ )","desc":"","updated":1650381339323,"created":1595961348801,"stub":false,"custom":{"stub":false,"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"7760ffb80fec59f813a8350ce254bcb0","links":[],"anchors":{},"children":["Cybv0wy1d2NbWoMaJ9Xst","jJJHMSzIVnRXuspVex7z3","u4tSbmkJewrKonY3sL544","WAKWMq3SeVmlAmZRqCbpB","rEbR1FrKkZzyjo6ahAgm3"],"parent":null,"data":{},"body":"\nDendron 官網: https://wiki.dendron.so/\n\n<!-- ![[首次使用 Dendron 紀錄|drops.2021.1226-first-day#使用-dendron-紀錄:#*]] -->\n<!-- <div class=\"portal-container\">\n<div class=\"portal-head\">\n<div class=\"portal-backlink\">\n<div class=\"portal-title\">From <span class=\"portal-text-title\">1226 使用 Dendron 紀錄</span></div>\n<a href=\"/notes/DTeYpEuPv3KIHugUyqZPu\" class=\"portal-arrow\">Go to text <span class=\"right-arrow\">→</span></a>\n</div>\n</div>\n<div id=\"portal-parent-anchor\" class=\"portal-parent\" markdown=\"1\">\n<div class=\"portal-parent-fader-top\"></div>\n<div class=\"portal-parent-fader-bottom\"></div><h2 id=\"使用-dendron-紀錄\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#使用-dendron-紀錄\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>使用 Dendron 紀錄</h2>\n</div></div> -->\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"randomNote":{},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false,"dendronVersion":"0.92.1"},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"/ᐠ ._. ᐟ\\✧","description":"網頁開發技術筆記"},"github":{"enableEditLink":false,"editLinkText":"Edit this page on GitHub","editBranch":"master","editViewMode":"tree","editRepository":"https://github.com/kiwijang/kiwijang.github.io.git"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","enableMermaid":true,"siteUrl":"https://kiwijang.github.io","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"siteFaviconPath":"favicon.ico","siteIndex":"root"},"site":{"siteHierarchies":["root"],"siteRootDir":"docs","siteUrl":"https://kiwijang.github.io","title":"/ᐠ ._. ᐟ\\✧"}}},"__N_SSG":true}